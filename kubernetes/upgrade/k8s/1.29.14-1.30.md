### 1. Download the public signing key for the Kubernetes package repositories.
```
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
```

### 2. Add the appropriate Kubernetes apt repository. 
```
# This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
```

### 3. Find the latest version
```
sudo apt update
sudo apt-cache madison kubeadm
```

### 4. Upgrade kubeadm:
```
sudo apt-mark unhold kubeadm && \
sudo apt-get update && sudo apt-get install -y kubeadm='1.30.14-1.1' && \
sudo apt-mark hold kubeadm
```

### 5. Verify that the download works and has the expected version:
```
kubeadm version
```

### 6. Verify the upgrade plan:
```
sudo kubeadm upgrade plan
```

### 7. execute the upgrade
```
sudo kubeadm upgrade apply v1.30.14
```
The command above only needs to be executed on 1st control plane. For other control plane nodes execute.<br>
```sudo kubeadm upgrade node```

### 8.Manually upgrade your CNI provider plugin.

###  9. Drain the master node
```
kubectl drain ekl-k8s-master-1.ponyworld.io --ignore-daemonsets
```

### 10. Upgrade the kubelet and kubectl
```
sudo apt-mark unhold kubelet kubectl && \
sudo apt-get update && sudo apt-get install -y kubelet='1.30.14-1.1' kubectl='1.30.14-1.1' && \
sudo apt-mark hold kubelet kubectl
```

### 11. Restart the kubelet
```
sudo systemctl daemon-reload
sudo systemctl restart kubelet
```

### 12. Bring the master node back online by marking it schedulable
```
kubectl uncordon ekl-k8s-master-1.ponyworld.io
```
## Upgrade Worker 1
### 1. Download the public signing key for the Kubernetes package repositories.
```
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
```

### 2. Add the appropriate Kubernetes apt repository.
```
# This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
```
### 3. Find the latest version
```
sudo apt update
sudo apt list --upgradable
sudo apt full-upgrade
sudo apt-cache madison kubeadm
```

### 4. Upgrade kubeadm on the worker node
```
sudo apt-mark unhold kubeadm && \
sudo apt-get update && sudo apt-get install -y kubeadm='1.30.14-1.1' && \
sudo apt-mark hold kubeadm
```

### 5. Upgrades the local kubelet configuration of worker node
```
sudo kubeadm upgrade node
```

### 6. Drain the worker node -- execute the command on master node
```
kubectl drain ekl-k8s-worker-1.ponyworld.io --ignore-daemonsets
```

### 7. Upgrade kubelet and kubectl
```
sudo apt-mark unhold kubelet kubectl && \
sudo apt-get update && sudo apt-get install -y kubelet='1.30.14-1.1' kubectl='1.30.14-1.1' && \
sudo apt-mark hold kubelet kubectl
```

### 8. Restart the kubelet
```
sudo systemctl daemon-reload
sudo systemctl restart kubelet
```

### 10. Uncordon the worker node-- Bring the node back online by marking it schedulable, execute on master node!
```
# execute the command on master node
kubectl uncordon ekl-k8s-worker-1.ponyworld.io
```